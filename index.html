<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>House Price Prediction</title>
  <style>
    :root{--bg:#f7f9fb;--card:#fff;--accent:#0066cc;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;padding:20px;background:var(--bg);color:#111}
    .wrap{max-width:820px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    main{display:grid;grid-template-columns:1fr 420px;gap:20px}
    form{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 4px 16px rgba(10,10,10,0.06)}
    .panel{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 4px 16px rgba(10,10,10,0.06)}
    label{display:block;font-size:14px;color:#222;margin-bottom:10px}
    input, select{width:100%;padding:8px;border:1px solid #e2e6ea;border-radius:8px;margin-top:6px;background:#fff}
    .row{display:flex;gap:12px}
    .row > label{flex:1}
    .actions{display:flex;gap:8px;align-items:center;margin-top:12px}
    button{background:var(--accent);color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer}
    button[disabled]{opacity:.6;cursor:default}
    .small{font-size:13px;color:var(--muted)}
    .result-value{font-size:28px;font-weight:600;margin:6px 0}
    pre{background:#f3f5f7;padding:10px;border-radius:8px;overflow:auto}
    .error{color:#b00020;margin-top:8px}
    @media (max-width:900px){main{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>House Price Prediction</h1>
      <div class="small">Fill the form, click Predict — result appears at right</div>
    </header>

    <main>
      <form id="predict-form" autocomplete="off">
        <div class="row">
          <label>Area (sq ft)
            <input name="area" type="number" step="any" required />
          </label>
          <label>Bedrooms
            <input name="bedrooms" type="number" step="1" required />
          </label>
        </div>

        <div class="row">
          <label>Bathrooms
            <input name="bathrooms" type="number" step="1" required />
          </label>
          <label>Stories
            <input name="stories" type="number" step="1" required />
          </label>
        </div>

        <div class="row">
          <label>Parking (count)
            <input name="parking" type="number" step="1" required />
          </label>
          <label>Furnishing status
            <select name="furnishingstatus" required>
              <option value="unfurnished">Unfurnished</option>
              <option value="semi-furnished">Semi-furnished</option>
              <option value="furnished">Furnished</option>
            </select>
          </label>
        </div>

        <div class="row">
          <label>Main road
            <select name="mainroad" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
          <label>Guestroom
            <select name="guestroom" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
        </div>

        <div class="row">
          <label>Basement
            <select name="basement" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
          <label>Hot water heating
            <select name="hotwaterheating" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
        </div>

        <div class="row">
          <label>Air conditioning
            <select name="airconditioning" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
          <label>Preferred area
            <select name="prefarea" required>
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </label>
        </div>

        <div class="actions">
          <button type="submit" id="submit-btn">Predict</button>
          <button type="button" id="clear-btn">Clear</button>
          <div class="small" id="status" style="margin-left:8px"></div>
        </div>

        <p id="form-error" class="error" aria-live="polite"></p>
      </form>

      <aside class="panel" id="result-panel" aria-live="polite">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="margin:0 0 6px 0">Prediction</h2>
          <div class="small" id="model-version">model: unknown</div>
        </div>

        <div id="result-content">
          <div class="result-value" id="prediction-value">—</div>
          <div id="prediction-text" class="small">No prediction yet</div>

          <h3 style="margin-top:12px;margin-bottom:6px;font-size:15px">Input</h3>
          <pre id="input-json">{}</pre>

          <h3 style="margin-top:12px;margin-bottom:6px;font-size:15px">Raw response</h3>
          <pre id="raw-json">waiting...</pre>
        </div>
      </aside>
    </main>
  </div>

  <script>
    (function(){
      const form = document.getElementById('predict-form');
      const errorEl = document.getElementById('form-error');
      const statusEl = document.getElementById('status');
      const submitBtn = document.getElementById('submit-btn');
      const clearBtn = document.getElementById('clear-btn');

      const predValEl = document.getElementById('prediction-value');
      const predTextEl = document.getElementById('prediction-text');
      const inputJsonEl = document.getElementById('input-json');
      const rawJsonEl = document.getElementById('raw-json');
      const modelVersionEl = document.getElementById('model-version');

      const REQUIRED_FIELDS = [
        'area','bedrooms','bathrooms','stories','mainroad','guestroom',
        'basement','hotwaterheating','airconditioning','parking','prefarea',
        'furnishingstatus'
      ];

      function normalizeForm(fd){
        // Build payload as types matching your Features model
        return {
          area: Number(fd.get('area')),
          bedrooms: parseInt(fd.get('bedrooms'), 10),
          bathrooms: parseInt(fd.get('bathrooms'), 10),
          stories: parseInt(fd.get('stories'), 10),
          mainroad: fd.get('mainroad') === 'true',
          guestroom: fd.get('guestroom') === 'true',
          basement: fd.get('basement') === 'true',
          hotwaterheating: fd.get('hotwaterheating') === 'true',
          airconditioning: fd.get('airconditioning') === 'true',
          parking: parseInt(fd.get('parking'), 10),
          prefarea: fd.get('prefarea') === 'true',
          furnishingstatus: String(fd.get('furnishingstatus'))
        };
      }

      function setBusy(on){
        submitBtn.disabled = on;
        statusEl.textContent = on ? 'Working…' : '';
      }

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        errorEl.textContent = '';
        setBusy(true);
        rawJsonEl.textContent = 'waiting...';
        predValEl.textContent = '—';
        predTextEl.textContent = 'Requesting prediction';

        try {
          const fd = new FormData(form);
          const payload = normalizeForm(fd);

          // Validate presence and numeric fields
          const missing = REQUIRED_FIELDS.filter(f => !(f in payload));
          if (missing.length){
            throw new Error('Missing fields: ' + missing.join(', '));
          }
          if ([payload.area, payload.bedrooms, payload.bathrooms, payload.stories, payload.parking].some(v => Number.isNaN(v))){
            throw new Error('Provide valid numbers for area, bedrooms, bathrooms, stories, parking');
          }

          // Call backend endpoint under Price_Prediction_Api path
          const resp = await fetch('/Price_Prediction_Api/api/predict', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
          });

          const text = await resp.text();
          let json = null;
          try { json = JSON.parse(text); } catch(e){ json = {raw: text}; }

          rawJsonEl.textContent = JSON.stringify(json, null, 2);
          inputJsonEl.textContent = JSON.stringify(payload, null, 2);

          if (!resp.ok){
            const errMsg = (json && (json.error || json.message)) || resp.statusText || 'Prediction failed';
            throw new Error(errMsg);
          }

          // Expecting {"predictions":[value], ...}
          const preds = json.predictions || [];
          const first = (preds.length && typeof preds[0] === 'number') ? preds[0] : (preds.length ? Number(preds[0]) : null);

          if (first === null || Number.isNaN(Number(first))){
            throw new Error('API returned no numeric prediction');
          }

          predValEl.textContent = '$' + Number(first).toLocaleString(undefined, {maximumFractionDigits:2});
          predTextEl.textContent = `Predicted price: $${Number(first).toFixed(2)}`;

          // show model_version if present
          if (json.model_version) modelVersionEl.textContent = 'model: ' + json.model_version;
          else modelVersionEl.textContent = 'model: unknown';

        } catch (err) {
          errorEl.textContent = err.message || String(err);
          predTextEl.textContent = 'Prediction failed';
        } finally {
          setBusy(false);
        }
      });

      clearBtn.addEventListener('click', function(){
        form.reset();
        predValEl.textContent = '—';
        predTextEl.textContent = 'No prediction yet';
        inputJsonEl.textContent = '{}';
        rawJsonEl.textContent = 'waiting...';
        errorEl.textContent = '';
        modelVersionEl.textContent = 'model: unknown';
      });
    })();
  </script>
</body>
</html>